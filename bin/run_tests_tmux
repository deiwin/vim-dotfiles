#!/bin/bash
set -e

if [ $# != 1 ]
then
  echo "Usage: $(basename $0) file_to_test"
  exit 1
fi

file=$1
extension="${file##*.}"
if [ "$extension" == "rb" ]
then
  test_command="rspec $file"
elif [ "$extension" == "go" ]
then
  test_command="sh -c 'cd $(dirname $file) && go test'"
else
  echo "Unknown file type"
  exit 1
fi

number_of_panes=$(tmux list-panes | wc -l)
if (($number_of_panes < 2))
then
  tmux split-window -d -p 25
fi
tmux send-keys -t bottom  C-m "$test_command" C-m

